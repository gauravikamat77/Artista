<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Palette & Random Color Generator</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative; /* Add relative positioning */
        }
        #container {
            text-align: center;
            position: relative;
            margin-left:65px;
        }
        .colorSquare {
            width: 50px;
            height: 50px;
            margin: 10px;
            cursor: pointer;
            border: 1px solid black;
            display: inline-block;
        }
        .palette {
            width: 300px;
            height: 150px;
            border-radius: 20px;
            background-color: #f0f0f0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .color-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 5px;
        }

        .popup {
            position: absolute;
            background-color: #fefefe;
            border: 1px solid #888;
            padding: 20px;
            width: 20%;
            z-index: 1;
            display: none; /* Hide by default */
            margin-right:150px;
        }
        #selectedColor {
            width: 150px;
            height: 150px;
            margin-top: 20px;
        }
        #colorBox {
            width: 150px;
            height: 150px;
            margin: 20px auto;
            border: 1px solid black;
        }
        #intensitySlider {
            position: absolute;
            top: 0;
            left: 0;
            margin-top: -20px; /* Adjust margin to make room for the slider */
        }
    </style>
</head>
<body>
    <div id="container">
        <h3>Click on a color from the palette to select:</h3>
        <div id="colorPalette" class="palette">
            <!-- Loop through the colors and create circles -->
            <div class="color-circle" style="background-color: #FF5733;" onclick="showPopup('#FF5733')"></div>
            <div class="color-circle" style="background-color: #33FF57;" onclick="showPopup('#33FF57')"></div>
            <div class="color-circle" style="background-color: #5733FF;" onclick="showPopup('#5733FF')"></div>
            <div class="color-circle" style="background-color: #FFD133;" onclick="showPopup('#FFD133')"></div>
            <div class="color-circle" style="background-color: #33FFF5;" onclick="showPopup('#33FFF5')"></div>
            <div class="color-circle" style="background-color: #F533FF;" onclick="showPopup('#F533FF')"></div>
            <div class="color-circle" style="background-color: #33FFAA;" onclick="showPopup('#33FFAA')"></div>
            <div class="color-circle" style="background-color: #AA33FF;" onclick="showPopup('#AA33FF')"></div>
            <div class="color-circle" style="background-color: #FFAA33;" onclick="showPopup('#FFAA33')"></div>
            <div class="color-circle" style="background-color: #AAFF33;" onclick="showPopup('#AAFF33')"></div>
            <div class="color-circle" style="background-color: #33FF57;" onclick="showPopup('#33FF57')"></div>
            <div class="color-circle" style="background-color: #5733FF;" onclick="showPopup('#5733FF')"></div>
        </div>
        <button onclick="checkSimilarity()">Check Similarity</button>
    </div>
    
    <div id="colorPopup" class="popup">
        <h2>Select Intensity</h2>
        <input type="range" id="intensitySlider" min="0" max="100" value="50" oninput="showSelectedColor()">
        <div id="selectedColor"></div>
        <div id="similarityResult" class="popup" style="display:none;"></div>
    </div>
    
    <div id="colorBox"></div>
    
    <script>
        function showPopup(color) {
            // Show the popup
            var popup = document.getElementById('colorPopup');
            popup.style.display = 'block';
            // Set the selected color
            document.getElementById('selectedColor').style.backgroundColor = color;
            // Set the data-color attribute of the slider to the selected color
            document.getElementById('intensitySlider').setAttribute('data-color', color);
        }

        function showSelectedColor() {
            var intensity = document.getElementById('intensitySlider').value;
            var color = document.getElementById('intensitySlider').getAttribute('data-color');
            // Calculate the RGB values for the selected intensity
            var r = parseInt(color.slice(1, 3), 16);
            var g = parseInt(color.slice(3, 5), 16);
            var b = parseInt(color.slice(5, 7), 16);
            // Calculate the amount of black and white to add based on the slider position
            var black = Math.round(255 * (100 - intensity) / 100);
            var white = Math.round(255 * intensity / 100);
            // Add black to the left and white to the right
            r = Math.max(0, Math.min(255, r - black + white));
            g = Math.max(0, Math.min(255, g - black + white));
            b = Math.max(0, Math.min(255, b - black + white));
            // Set the background color of the selected color square
            document.getElementById('selectedColor').style.backgroundColor = 'rgb(' + r + ',' + g + ',' + b + ')';
        }

        var similarityCalculated = false;

        function checkSimilarity() {
            if (!similarityCalculated) {
                // Get the randomly generated color
                var randomColor = document.getElementById('colorBox').style.backgroundColor;
                // Get the color chosen from the slider
                var selectedColor = document.getElementById('selectedColor').style.backgroundColor;
                // Convert the colors to hex format
                var randomHex = rgbToHex(randomColor);
                var selectedHex = rgbToHex(selectedColor);
                // Call the function to calculate similarity score
                calculateSimilarity(randomHex, selectedHex);
                // Set the flag to indicate that similarity score has been calculated
                similarityCalculated = true;
            }
        }

        function calculateSimilarity(randomColor, selectedColor) {
            // Convert RGB to Lab color space
            var randomLab = rgbToLab(randomColor);
            var selectedLab = rgbToLab(selectedColor);
        
            // Calculate the Euclidean distance between LAB color coordinates
            var delta_l = selectedLab[0] - randomLab[0];
            var delta_a = selectedLab[1] - randomLab[1];
            var delta_b = selectedLab[2] - randomLab[2];
            var color_distance = Math.sqrt(delta_l ** 2 + delta_a ** 2 + delta_b ** 2);
        
            // Calculate color similarity percentage
            var max_distance = Math.sqrt(100 ** 2 + 100 ** 2 + 100 ** 2); // Maximum possible distance in LAB color space
            var similarity_percentage = ((max_distance - color_distance) / max_distance) * 100;
        
            // Display the similarity score
            document.getElementById('similarityResult').innerText = 'Similarity Score: ' + similarity_percentage.toFixed(2) + '%';
            document.getElementById('similarityResult').style.display = 'block';
        
            // Check if similarity score is above 75
            if (similarity_percentage >= 75) {
                // Display Congratulations popup after 2 seconds
                setTimeout(function() {
                    alert("Congratulations, you have unlocked the next level!");
                    window.location.href="/mixingcolors";
                    <div id="popup1" class="popup" style="z-index: 999;">
                        <p id="step1">1.You will be provided with color palette and a target color, but not a slider</p>
                        <p id="step2" style="display:none">2.You have to mix two pure colors,first color chosen will be displayed in first canvas, and second time chosen will be displayed in second canvas and your aim is to match the target color.</p>
                        <p id="step3" style="display:none">4.Make sure the similarity score is 75% or above.</p>
                        <button id="nextButton" onclick="nextStep(1)">Next</button>
                    </div>
                }, 2000);
              
            } else {
                // Display Try again popup
                alert("Try again, you have not passed");
        
                // Clear the score
                document.getElementById('similarityResult').style.display = 'none';
                // Reset the page
                resetPage();
            }
        }
        
        function resetPage() {
            // Hide the color popup
            document.getElementById('colorPopup').style.display = 'none';
        
            // Clear selected color
            document.getElementById('selectedColor').style.backgroundColor = '';
        
            // Reset similarityCalculated flag
            similarityCalculated = false;
            checkSimilarity();
        }
        
        
        function rgbToHex(rgb) {
            // Convert RGB color to Hex color
            var rgbArr = rgb.match(/\d+/g);
            var hex = "#" + ((1 << 24) + (parseInt(rgbArr[0]) << 16) + (parseInt(rgbArr[1]) << 8) + parseInt(rgbArr[2])).toString(16).slice(1);
            return hex;
        }

        function rgbToLab(rgb) {
            // Convert RGB color to Lab color
            var r = parseInt(rgb.slice(1, 3), 16) / 255;
            var g = parseInt(rgb.slice(3, 5), 16) / 255;
            var b = parseInt(rgb.slice(5, 7), 16) / 255;

            // Convert to XYZ color space
            r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
            g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
            b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;

            r *= 100;
            g *= 100;
            b *= 100;

            var x = r * 0.4124 + g * 0.3576 + b * 0.1805;
            var y = r * 0.2126 + g * 0.7152 + b * 0.0722;
            var z = r * 0.0193 + g * 0.1192 + b * 0.9505;

            // Convert to Lab color space
            x /= 95.047;
            y /= 100.000;
            z /= 108.883;

            x = x > 0.008856 ? Math.pow(x, 1 / 3) : 7.787 * x + 16 / 116;
            y = y > 0.008856 ? Math.pow(y, 1 / 3) : 7.787 * y + 16 / 116;
            z = z > 0.008856 ? Math.pow(z, 1 / 3) : 7.787 * z + 16 / 116;

            var L = 116 * y - 16;
            var a = 500 * (x - y);
            var b = 200 * (y - z);

            return [L, a, b];
        }

        // Close the popup when clicking outside of it
        window.onclick = function(event) {
            var popup = document.getElementById('colorPopup');
            if (event.target == popup) {
                popup.style.display = 'none';
            }
        }

        // Set the provided colors for random generation
        var colors = ['#d92809', '#e65512', '#ad6f03', '#56d62b', '#64babd', '#071a4a', '#cf51af'];

        // Set the random color when the page loads
        var randomIndex = Math.floor(Math.random() * colors.length);
        var randomColor = colors[randomIndex];
        document.getElementById('colorBox').style.backgroundColor = randomColor;

        
    </script>
</body>
</html>
