<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color Palette & Random Color Generator</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            position: relative; /* Add relative positioning */
        }
        #container {
            text-align: center;
            position: relative;
            margin-left: 65px;
        }
        .colorSquare {
            width: 150px;
            height: 150px;
            margin: 10px;
            cursor: pointer;
            border: 1px solid black;
            display: inline-block;
        }
        .palette {
            width: 300px;
            height: 150px;
            border-radius: 20px;
            background-color: #f0f0f0;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            padding: 10px;
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
        }

        .color-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 5px;
        }

        .popup {
            position: absolute;
            background-color: #fefefe;
            border: 1px solid #888;
            padding: 20px;
            width: 20%;
            z-index: 1;
            display: none; /* Hide by default */
            margin-right: 150px;
        }
        #selectedColor {
            width: 100px;
            height: 100px;
            margin-top: 20px;
        }
        #colorBox1, #colorBox2, #colorBox3 {
            width: 150px;
            height: 150px;
            margin: 20px;
            border: 1px solid black;
            display: inline-block;
        }
        #intensitySlider {
            position: absolute;
            top: 0;
            left: 0;
            margin-top: -20px; /* Adjust margin to make room for the slider */
        }
        #selectColorBtn {
            margin-top: 20px;
        }
        #colorBox {
            width: 150px;
            height: 150px;
            margin-left: 20px;
            border: 1px solid black;
            position: absolute; /* Set position to absolute */
            left: 20px; /* Set left margin */

        }
    </style>
</head>
<body>
    <div id="container">
        <div id="colorBox1"></div>
        <div id="colorBox2"></div>
        <div id="colorBox3"></div> <!-- New color box for displaying mixed color -->
        <h3>Click on a color from the palette to select:</h3>
        <div id="colorPalette" class="palette" style="margin-right:-65px">
            <!-- Loop through the colors and create circles -->
            <div class="color-circle" style="background-color: #FF5733;" onclick="showPopup('#FF5733')"></div>
            <div class="color-circle" style="background-color: #33FF57;" onclick="showPopup('#33FF57')"></div>
            <div class="color-circle" style="background-color: #5733FF;" onclick="showPopup('#5733FF')"></div>
            <div class="color-circle" style="background-color: #FFD133;" onclick="showPopup('#FFD133')"></div>
            <div class="color-circle" style="background-color: #33FFF5;" onclick="showPopup('#33FFF5')"></div>
            <div class="color-circle" style="background-color: #F533FF;" onclick="showPopup('#F533FF')"></div>
            <div class="color-circle" style="background-color: #33FFAA;" onclick="showPopup('#33FFAA')"></div>
            <div class="color-circle" style="background-color: #AA33FF;" onclick="showPopup('#AA33FF')"></div>
            <div class="color-circle" style="background-color: #FFAA33;" onclick="showPopup('#FFAA33')"></div>
            <div class="color-circle" style="background-color: #AAFF33;" onclick="showPopup('#AAFF33')"></div>
            <div class="color-circle" style="background-color: #33FF57;" onclick="showPopup('#33FF57')"></div>
            <div class="color-circle" style="background-color: #5733FF;" onclick="showPopup('#5733FF')"></div>
        </div>
        <button onclick="mixColors()">Mix Colors</button> <!-- Button to mix colors -->
        <button onclick="checkSimilarity()">Check Similarity</button>
    </div>
    <div id="colorBox"></div>

    <div id="colorPopup" class="popup" style="margin-right:-400px;height:190px;width:150px;margin-top:150px;padding-top:2px">
        <h2 style="font-size:17px;padding-bottom:4px"> Select Intensity</h2>
        <input type="range" id="intensitySlider" min="0" max="100" value="50" oninput="showSelectedColor()">
        <button id="selectColorBtn" onclick="selectColor()" style="margin-top:-5px" >Select Color</button>
        <div id="selectedColor"></div>
        <div id="similarityResult" class="popup" style="display:none;"></div>
    </div>
    
    <script>
        var selectedSquare = 1;

        function showPopup(color) {
            // Show the popup
            var popup = document.getElementById('colorPopup');
            popup.style.display = 'block';
            // Set the selected color
            document.getElementById('selectedColor').style.backgroundColor = color;
            // Set the data-color attribute of the slider to the selected color
            document.getElementById('intensitySlider').setAttribute('data-color', color);
        }

        function showSelectedColor() {
            var intensity = document.getElementById('intensitySlider').value;
            var color = document.getElementById('intensitySlider').getAttribute('data-color');
            // Calculate the RGB values for the selected intensity
            var r = parseInt(color.slice(1, 3), 16);
            var g = parseInt(color.slice(3, 5), 16);
            var b = parseInt(color.slice(5, 7), 16);
            // Calculate the amount of black and white to add based on the slider position
            var black = Math.round(255 * (100 - intensity) / 100);
            var white = Math.round(255 * intensity / 100);
            // Add black to the left and white to the right
            r = Math.max(0, Math.min(255, r - black + white));
            g = Math.max(0, Math.min(255, g - black + white));
            b = Math.max(0, Math.min(255, b - black + white));
            // Set the background color of the selected color square
            document.getElementById('selectedColor').style.backgroundColor = 'rgb(' + r + ',' + g + ',' + b + ')';
        }

        var selectedSquare = 1; // Variable to keep track of which square to update

        function selectColor() {
            // Get the selected color
            var selectedColor = document.getElementById('selectedColor').style.backgroundColor;
            // Set the background color of the selected square
            document.getElementById('colorBox' + selectedSquare).style.backgroundColor = selectedColor;
            // Hide the color popup
            document.getElementById('colorPopup').style.display = 'none';
            // Increment the selected square variable
            selectedSquare++;
            // Reset the selected square variable if it exceeds 2
            if (selectedSquare > 2) {
                selectedSquare = 1;
            }
        }

        function mixColors() {
            // Get the colors of colorBox1 and colorBox2
            var color1 = document.getElementById('colorBox1').style.backgroundColor;
            var color2 = document.getElementById('colorBox2').style.backgroundColor;
            // Parse the colors to RGB format
            var rgb1 = parseColor(color1);
            var rgb2 = parseColor(color2);
            // Calculate the mixed color
            var mixedColor = mixColor(rgb1, rgb2);
            // Set the background color of colorBox3 to the mixed color
            document.getElementById('colorBox3').style.backgroundColor = 'rgb(' + mixedColor.r + ',' + mixedColor.g + ',' + mixedColor.b + ')';
            // Check similarity with the random color
            checkSimilarity();
        }

        function mixColor(rgb1, rgb2) {
            // Calculate the average of each RGB component
            var mixedColor = {
                r: Math.round((rgb1.r + rgb2.r) / 2),
                g: Math.round((rgb1.g + rgb2.g) / 2),
                b: Math.round((rgb1.b + rgb2.b) / 2)
            };
            return mixedColor;
        }

        function checkSimilarity() {
            var mixedColorHex = document.getElementById('colorBox3').style.backgroundColor;
            var randomColorHex = document.getElementById('colorBox').style.backgroundColor;
            var mixedColorRgb = hexToRgb(mixedColorHex);
            var randomColorRgb = hexToRgb(randomColorHex);
            var similarityPercentage = calculateSimilarityPercentage(mixedColorRgb, randomColorRgb);
            var resultElement = document.getElementById('similarityResult');
            resultElement.style.display = 'block';
            resultElement.innerText = 'Similarity Percentage: ' + similarityPercentage.toFixed(2) + '%';
        }

        function hexToRgb(hex) {
            var r = parseInt(hex.substring(1, 3), 16);
            var g = parseInt(hex.substring(3, 5), 16);
            var b = parseInt(hex.substring(5, 7), 16);
            return { r: r, g: g, b: b };
        }

        function calculateSimilarityPercentage(color1, color2) {
            var lab1 = rgbToLab(color1);
            var lab2 = rgbToLab(color2);
            var max_distance = Math.sqrt(100 ** 2 + 100 ** 2 + 100 ** 2);
            var distance = colorDistanceLab(lab1, lab2);
            return ((max_distance - distance) / max_distance) * 100;
        }

        function rgbToLab(rgb) {
            var r = rgb.r / 255;
            var g = rgb.g / 255;
            var b = rgb.b / 255;

            r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92;
            g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92;
            b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92;

            r *= 100;
            g *= 100;
            b *= 100;

            var x = r * 0.4124 + g * 0.3576 + b * 0.1805;
            var y = r * 0.2126 + g * 0.7152 + b * 0.0722;
            var z = r * 0.0193 + g * 0.1192 + b * 0.9505;

            x /= 95.047;
            y /= 100.000;
            z /= 108.883;

            x = x > 0.008856 ? Math.pow(x, 1 / 3) : 7.787 * x + 16 / 116;
            y = y > 0.008856 ? Math.pow(y, 1 / 3) : 7.787 * y + 16 / 116;
            z = z > 0.008856 ? Math.pow(z, 1 / 3) : 7.787 * z + 16 / 116;

            var L = 116 * y - 16;
            var a = 500 * (x - y);
            var b = 200 * (y - z);

            return [L, a, b];
        }

        function colorDistanceLab(lab1, lab2) {
            var delta_l = lab1[0] - lab2[0];
            var delta_a = lab1[1] - lab2[1];
            var delta_b = lab1[2] - lab2[2];
            return Math.sqrt(delta_l * delta_l + delta_a * delta_a + delta_b * delta_b);
        }

        function parseColor(color) {
            var match = color.match(/rgb\((\d+), (\d+), (\d+)\)/);
            if (match) {
                return {
                    r: parseInt(match[1]),
                    g: parseInt(match[2]),
                    b: parseInt(match[3])
                };
            }
            return null;
        }
        var colors = ['#d92809', '#e65512', '#ad6f03', '#56d62b', '#64babd', '#071a4a', '#cf51af'];

        // Set the random color when the page loads
        var randomIndex = Math.floor(Math.random() * colors.length);
        var randomColor = colors[randomIndex];
        document.getElementById('colorBox').style.backgroundColor = randomColor;
    </script>
</body>
</html>
